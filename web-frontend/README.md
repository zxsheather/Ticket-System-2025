# ç«è½¦ç¥¨ç³»ç»Ÿ Web å‰ç«¯

è¿™æ˜¯ä¸€ä¸ªåŸºäº Node.js + Express + EJS çš„ç°ä»£åŒ– Web å‰ç«¯ï¼Œä¸ºç«è½¦ç¥¨ç®¡ç†ç³»ç»Ÿæä¾›å®Œæ•´çš„ç”¨æˆ·ç•Œé¢å’Œç®¡ç†åŠŸèƒ½ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### ç”¨æˆ·åŠŸèƒ½
- **ç”¨æˆ·è®¤è¯**: æ³¨å†Œã€ç™»å½•ã€ä¸ªäººèµ„æ–™ç®¡ç†
- **ç¥¨åŠ¡æŸ¥è¯¢**: å®æ—¶æŸ¥è¯¢ç«è½¦ç¥¨ä¿¡æ¯ã€åº§ä½ä½™é‡
- **åœ¨çº¿è´­ç¥¨**: æ”¯æŒå¤šç§åº§ä½ç±»å‹çš„ç¥¨åŠ¡è´­ä¹°
- **è®¢å•ç®¡ç†**: æŸ¥çœ‹å†å²è®¢å•ã€é€€ç¥¨æ“ä½œ
- **å®æ—¶é€šçŸ¥**: WebSocket å®æ—¶é€šçŸ¥ç³»ç»Ÿ

### ç®¡ç†å‘˜åŠŸèƒ½
- **ç³»ç»Ÿç›‘æ§**: å®æ—¶ç³»ç»Ÿæ€§èƒ½ç›‘æ§å’Œå¥åº·æ£€æŸ¥
- **ç”¨æˆ·ç®¡ç†**: ç”¨æˆ·è´¦æˆ·ç®¡ç†ã€æƒé™æ§åˆ¶
- **åˆ—è½¦ç®¡ç†**: åˆ—è½¦ä¿¡æ¯ç®¡ç†ã€åº§ä½é…ç½®
- **è®¢å•ç®¡ç†**: å…¨å±€è®¢å•æŸ¥çœ‹å’Œç®¡ç†
- **æ•°æ®ç»Ÿè®¡**: ç³»ç»Ÿä½¿ç”¨ç»Ÿè®¡å’ŒæŠ¥è¡¨

### æŠ€æœ¯ç‰¹æ€§
- **å“åº”å¼è®¾è®¡**: æ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯è®¿é—®
- **å®æ—¶é€šä¿¡**: WebSocket æ”¯æŒå®æ—¶æ•°æ®æ›´æ–°
- **å®‰å…¨é˜²æŠ¤**: è¯·æ±‚é¢‘ç‡é™åˆ¶ã€CSRF é˜²æŠ¤ã€è¾“å…¥éªŒè¯
- **æ€§èƒ½ä¼˜åŒ–**: èµ„æºå‹ç¼©ã€ç¼“å­˜ç­–ç•¥ã€è´Ÿè½½å‡è¡¡
- **æ—¥å¿—ç³»ç»Ÿ**: å®Œæ•´çš„æ—¥å¿—è®°å½•å’Œé”™è¯¯è¿½è¸ª

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- **Node.js**: >= 14.0.0
- **npm**: >= 6.0.0
- **æ“ä½œç³»ç»Ÿ**: Linux, macOS, Windows
- **å†…å­˜**: è‡³å°‘ 512MB å¯ç”¨å†…å­˜
- **å­˜å‚¨**: è‡³å°‘ 100MB å¯ç”¨ç£ç›˜ç©ºé—´

## ğŸ› ï¸ å®‰è£…å’Œé…ç½®

### 1. å…‹éš†é¡¹ç›®

```bash
cd /path/to/Ticket-System-2025/web-frontend
```

### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

### 3. ç¯å¢ƒé…ç½®

å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶å¹¶æ ¹æ®éœ€è¦ä¿®æ”¹ï¼š

```bash
cp .env.example .env
```

ä¸»è¦é…ç½®é¡¹ï¼š

```bash
# åŸºæœ¬é…ç½®
NODE_ENV=development
PORT=3000
HOST=0.0.0.0

# ä¼šè¯å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨å¼ºéšæœºå­—ç¬¦ä¸²ï¼‰
SESSION_SECRET=your-super-secret-session-key

# C++åç«¯è¿æ¥é…ç½®
BACKEND_HOST=localhost
BACKEND_PORT=12345
BACKEND_TIMEOUT=30000

# å®‰å…¨é…ç½®
RATE_LIMIT_MAX=100
CORS_ORIGIN=http://localhost:3000
```

### 4. åˆ›å»ºå¿…è¦ç›®å½•

```bash
mkdir -p logs public/uploads tmp
```

## ğŸš€ å¯åŠ¨æœåŠ¡

### å¼€å‘æ¨¡å¼

```bash
# ä½¿ç”¨æµ‹è¯•å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
./test-start.sh

# æˆ–ç›´æ¥å¯åŠ¨
npm start

# æˆ–ä½¿ç”¨å¼€å‘æ¨¡å¼ï¼ˆæ”¯æŒçƒ­é‡è½½ï¼‰
npm run dev
```

### ç”Ÿäº§æ¨¡å¼

```bash
# ä½¿ç”¨ PM2 è¿›ç¨‹ç®¡ç†å™¨
npm install -g pm2
pm2 start ecosystem.config.js

# æˆ–ä½¿ç”¨å¢å¼ºå¯åŠ¨è„šæœ¬
./start-enhanced.sh
```

## ğŸ“± è®¿é—®ç•Œé¢

æœåŠ¡å¯åŠ¨åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **ç”¨æˆ·ç•Œé¢**: http://localhost:3000
- **ç™»å½•é¡µé¢**: http://localhost:3000/login
- **æ³¨å†Œé¡µé¢**: http://localhost:3000/register
- **ç®¡ç†å‘˜é¢æ¿**: http://localhost:3000/admin
- **ç³»ç»Ÿå¥åº·æ£€æŸ¥**: http://localhost:3000/health

## ğŸ”§ API æ¥å£

### ç”¨æˆ· API
- `POST /api/user/login` - ç”¨æˆ·ç™»å½•
- `POST /api/user/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/user/logout` - ç”¨æˆ·ç™»å‡º
- `GET /api/user/profile` - è·å–ç”¨æˆ·èµ„æ–™
- `PUT /api/user/profile` - æ›´æ–°ç”¨æˆ·èµ„æ–™

### ç¥¨åŠ¡ API
- `GET /api/ticket/search` - æŸ¥è¯¢è½¦ç¥¨
- `GET /api/ticket/transfer` - æŸ¥è¯¢ä¸­è½¬æ–¹æ¡ˆ
- `POST /api/order/buy` - è´­ä¹°è½¦ç¥¨
- `GET /api/order/list` - æŸ¥è¯¢è®¢å•
- `POST /api/order/refund` - é€€ç¥¨

### ç®¡ç†å‘˜ API
- `GET /api/admin/users` - ç”¨æˆ·ç®¡ç†
- `GET /api/admin/trains` - åˆ—è½¦ç®¡ç†
- `GET /api/admin/orders` - è®¢å•ç®¡ç†
- `GET /api/system/status` - ç³»ç»ŸçŠ¶æ€

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
web-frontend/
â”œâ”€â”€ app.js                 # ä¸»åº”ç”¨ç¨‹åºå…¥å£
â”œâ”€â”€ package.json          # ä¾èµ–é…ç½®
â”œâ”€â”€ .env                  # ç¯å¢ƒé…ç½®
â”œâ”€â”€ config/               # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ app.js           # åº”ç”¨é…ç½®
â”‚   â””â”€â”€ database.js      # æ•°æ®åº“é…ç½®
â”œâ”€â”€ controllers/          # æ§åˆ¶å™¨
â”‚   â””â”€â”€ ticketController.js
â”œâ”€â”€ middleware/           # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ auth.js          # è®¤è¯ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ error.js         # é”™è¯¯å¤„ç†
â”‚   â””â”€â”€ validation.js    # è¾“å…¥éªŒè¯
â”œâ”€â”€ routes/              # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ user.js          # ç”¨æˆ·è·¯ç”±
â”‚   â”œâ”€â”€ ticket.js        # ç¥¨åŠ¡è·¯ç”±
â”‚   â”œâ”€â”€ order.js         # è®¢å•è·¯ç”±
â”‚   â”œâ”€â”€ train.js         # åˆ—è½¦è·¯ç”±
â”‚   â””â”€â”€ admin.js         # ç®¡ç†å‘˜è·¯ç”±
â”œâ”€â”€ views/               # è§†å›¾æ¨¡æ¿
â”‚   â”œâ”€â”€ layout.ejs       # ä¸»å¸ƒå±€
â”‚   â”œâ”€â”€ index.ejs        # é¦–é¡µ
â”‚   â”œâ”€â”€ login.ejs        # ç™»å½•é¡µ
â”‚   â”œâ”€â”€ register.ejs     # æ³¨å†Œé¡µ
â”‚   â”œâ”€â”€ search.ejs       # æœç´¢é¡µ
â”‚   â”œâ”€â”€ orders.ejs       # è®¢å•é¡µ
â”‚   â”œâ”€â”€ profile.ejs      # ä¸ªäººèµ„æ–™
â”‚   â”œâ”€â”€ admin.ejs        # ç®¡ç†é¢æ¿
â”‚   â””â”€â”€ partials/        # é¡µé¢ç»„ä»¶
â”œâ”€â”€ public/              # é™æ€èµ„æº
â”‚   â”œâ”€â”€ css/            # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ js/             # å‰ç«¯è„šæœ¬
â”‚   â””â”€â”€ images/         # å›¾ç‰‡èµ„æº
â”œâ”€â”€ utils/               # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ logger.js        # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ notificationSystem.js  # é€šçŸ¥ç³»ç»Ÿ
â”‚   â””â”€â”€ systemMonitor.js # ç³»ç»Ÿç›‘æ§
â””â”€â”€ logs/               # æ—¥å¿—æ–‡ä»¶
```

## ğŸ” å®‰å…¨ç‰¹æ€§

- **ä¼šè¯ç®¡ç†**: å®‰å…¨çš„ä¼šè¯é…ç½®å’Œè¿‡æœŸå¤„ç†
- **è¾“å…¥éªŒè¯**: æ‰€æœ‰ç”¨æˆ·è¾“å…¥çš„ä¸¥æ ¼éªŒè¯
- **CSRF é˜²æŠ¤**: è·¨ç«™è¯·æ±‚ä¼ªé€ é˜²æŠ¤
- **XSS é˜²æŠ¤**: è·¨ç«™è„šæœ¬æ”»å‡»é˜²æŠ¤
- **è¯·æ±‚é™åˆ¶**: API è°ƒç”¨é¢‘ç‡é™åˆ¶
- **æƒé™æ§åˆ¶**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### ç³»ç»Ÿç›‘æ§
- CPU å’Œå†…å­˜ä½¿ç”¨ç‡ç›‘æ§
- ç£ç›˜ç©ºé—´ä½¿ç”¨ç›‘æ§
- ç½‘ç»œè¿æ¥çŠ¶æ€ç›‘æ§
- åº”ç”¨æ€§èƒ½æŒ‡æ ‡ç›‘æ§

### æ—¥å¿—è®°å½•
- è®¿é—®æ—¥å¿—è®°å½•
- é”™è¯¯æ—¥å¿—è®°å½•
- ç³»ç»Ÿæ“ä½œæ—¥å¿—
- ç”¨æˆ·è¡Œä¸ºæ—¥å¿—

### å®æ—¶é€šçŸ¥
- WebSocket å®æ—¶é€šçŸ¥
- ç³»ç»ŸçŠ¶æ€å˜æ›´é€šçŸ¥
- ç”¨æˆ·æ“ä½œç»“æœé€šçŸ¥
- ç®¡ç†å‘˜è­¦æŠ¥é€šçŸ¥

## ğŸ”§ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½

1. **åˆ›å»ºè·¯ç”±**: åœ¨ `routes/` ç›®å½•ä¸‹åˆ›å»ºæˆ–ä¿®æ”¹è·¯ç”±æ–‡ä»¶
2. **æ·»åŠ è§†å›¾**: åœ¨ `views/` ç›®å½•ä¸‹åˆ›å»º EJS æ¨¡æ¿
3. **ç¼–å†™æ ·å¼**: åœ¨ `public/css/` ä¸­æ·»åŠ  CSS æ ·å¼
4. **å‰ç«¯è„šæœ¬**: åœ¨ `public/js/` ä¸­æ·»åŠ  JavaScript åŠŸèƒ½
5. **æµ‹è¯•éªŒè¯**: è¿è¡Œæµ‹è¯•ç¡®ä¿åŠŸèƒ½æ­£å¸¸

### ä»£ç è§„èŒƒ

- ä½¿ç”¨ ES6+ è¯­æ³•
- éµå¾ª Node.js æœ€ä½³å®è·µ
- æ³¨é‡ä»£ç å¯è¯»æ€§å’Œç»´æŠ¤æ€§
- å®Œæ•´çš„é”™è¯¯å¤„ç†
- è¯¦ç»†çš„æ³¨é‡Šè¯´æ˜

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å†²çª**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   lsof -i :3000
   # ä¿®æ”¹ .env ä¸­çš„ PORT é…ç½®
   ```

2. **ä¾èµ–å®‰è£…å¤±è´¥**
   ```bash
   # æ¸…é™¤ç¼“å­˜é‡æ–°å®‰è£…
   npm cache clean --force
   npm install
   ```

3. **C++åç«¯è¿æ¥å¤±è´¥**
   - æ£€æŸ¥åç«¯ç¨‹åºæ˜¯å¦å·²ç¼–è¯‘
   - ç¡®è®¤åç«¯ç¨‹åºæ­£åœ¨è¿è¡Œ
   - éªŒè¯ç«¯å£é…ç½®æ˜¯å¦æ­£ç¡®

4. **æƒé™é—®é¢˜**
   ```bash
   # ç¡®ä¿æœ‰è¶³å¤Ÿçš„æ–‡ä»¶æƒé™
   chmod +x start-enhanced.sh
   chmod 755 logs/
   ```

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/combined.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f logs/error.log

# æŸ¥çœ‹ç³»ç»Ÿç›‘æ§æ—¥å¿—
tail -f logs/system-monitor.log
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

- **èµ„æºå‹ç¼©**: å¯ç”¨ gzip å‹ç¼©
- **ç¼“å­˜ç­–ç•¥**: é™æ€èµ„æºç¼“å­˜
- **è¿æ¥æ± **: æ•°æ®åº“è¿æ¥ä¼˜åŒ–
- **è´Ÿè½½å‡è¡¡**: å¤šè¿›ç¨‹éƒ¨ç½²æ”¯æŒ

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ LICENSE æ–‡ä»¶

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤ Issue
- å‘é€é‚®ä»¶
- æŸ¥çœ‹æ–‡æ¡£

---

**ç«è½¦ç¥¨ç³»ç»Ÿå›¢é˜Ÿ**  
ç‰ˆæœ¬: 1.0.0  
æ›´æ–°æ—¥æœŸ: 2025å¹´5æœˆ31æ—¥

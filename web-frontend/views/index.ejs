<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> - 火车票订票系统</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body {
            background-color: #f8f9fa;
        }
        
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 0;
            margin-bottom: 40px;
        }
        
        .search-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 30px;
            margin-top: -50px;
            position: relative;
            z-index: 2;
        }
        
        .feature-card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            margin-bottom: 30px;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-icon {
            font-size: 3em;
            margin-bottom: 20px;
            color: #667eea;
        }
        
        .stats-section {
            background: white;
            padding: 50px 0;
            margin: 40px 0;
        }
        
        .stat-item {
            text-align: center;
            padding: 20px;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }
        
        .navbar-brand {
            font-weight: bold;
            color: #0066cc !important;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 10px 30px;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            transform: translateY(-2px);
        }
        
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-train me-2"></i>
                火车票订票系统
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/search">
                            <i class="fas fa-search me-1"></i>车票查询
                        </a>
                    </li>
                    <% if (user) { %>
                    <li class="nav-item">
                        <a class="nav-link" href="/orders">
                            <i class="fas fa-list-alt me-1"></i>我的订单
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/profile">
                            <i class="fas fa-user me-1"></i>个人中心
                        </a>
                    </li>
                    <% if (user.privilege >= 5) { %>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin">
                            <i class="fas fa-cog me-1"></i>系统管理
                        </a>
                    </li>
                    <% } %>
                    <% } %>
                </ul>
                
                <ul class="navbar-nav">
                    <% if (user) { %>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i>
                            <%= user.name || user.username %>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/profile">
                                <i class="fas fa-user me-2"></i>个人信息
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="logout()">
                                <i class="fas fa-sign-out-alt me-2"></i>退出登录
                            </a></li>
                        </ul>
                    </li>
                    <% } else { %>
                    <li class="nav-item">
                        <a class="nav-link" href="/login">
                            <i class="fas fa-sign-in-alt me-1"></i>登录
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/register">
                            <i class="fas fa-user-plus me-1"></i>注册
                        </a>
                    </li>
                    <% } %>
                </ul>
            </div>
        </div>
    </nav>

    <!-- 英雄区域 -->
    <section class="hero-section text-center">
        <div class="container">
            <h1 class="display-4 mb-4">
                <i class="fas fa-train me-3"></i>
                智能火车票订票系统
            </h1>
            <p class="lead mb-5">安全、快捷、便民的在线订票服务，让您的出行更加轻松</p>
        </div>
    </section>

    <!-- 快速搜索 -->
    <div class="container">
        <div class="search-card">
            <h3 class="text-center mb-4">
                <i class="fas fa-search me-2"></i>
                快速查询车票
            </h3>
            <form id="quickSearchForm">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label for="fromStation" class="form-label">出发地</label>
                        <input type="text" class="form-control" id="fromStation" placeholder="请输入出发城市" required>
                    </div>
                    <div class="col-md-3">
                        <label for="toStation" class="form-label">目的地</label>
                        <input type="text" class="form-control" id="toStation" placeholder="请输入到达城市" required>
                    </div>
                    <div class="col-md-3">
                        <label for="travelDate" class="form-label">出发日期</label>
                        <input type="text" class="form-control" id="travelDate" 
                               placeholder="MM-DD (如: 06-15)" pattern="\d{2}-\d{2}" 
                               title="请输入MM-DD格式的日期，如: 06-15" required>
                    </div>
                    <div class="col-md-3">
                        <label for="sortBy" class="form-label">排序方式</label>
                        <select class="form-select" id="sortBy">
                            <option value="time">按时间排序</option>
                            <option value="cost">按价格排序</option>
                        </select>
                    </div>
                </div>
                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-search me-2"></i>
                        查询车票
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 功能特色 -->
    <div class="container my-5">
        <div class="row">
            <div class="col-md-3">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h5>24小时服务</h5>
                    <p class="text-muted">全天候在线订票服务，随时随地满足您的出行需求</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h5>安全可靠</h5>
                    <p class="text-muted">采用先进的安全技术，保障您的个人信息和资金安全</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <h5>多端同步</h5>
                    <p class="text-muted">支持多设备访问，数据实时同步，订票信息随身携带</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-headset"></i>
                    </div>
                    <h5>贴心服务</h5>
                    <p class="text-muted">智能推荐、候补购票、退改签服务，让出行更加便捷</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 系统统计 -->
    <section class="stats-section">
        <div class="container">
            <div class="row">
                <div class="col-md-3">
                    <div class="stat-item">
                        <div class="stat-number">1000+</div>
                        <div class="text-muted">覆盖城市</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-item">
                        <div class="stat-number">5000+</div>
                        <div class="text-muted">列车班次</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-item">
                        <div class="stat-number">100万+</div>
                        <div class="text-muted">注册用户</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-item">
                        <div class="stat-number">99.9%</div>
                        <div class="text-muted">系统稳定性</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 页脚 -->
    <footer class="bg-dark text-light py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h6><i class="fas fa-train me-2"></i>火车票订票系统</h6>
                    <p class="mb-0">安全、快捷、便民的在线订票服务</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">
                        <i class="fas fa-code me-1"></i>
                        Ticket System 2025 Web Frontend
                    </p>
                    <p class="mb-0">
                        <small>服务时间: 24小时全天候</small>
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Toast 通知容器 -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="toast" class="toast" role="alert">
            <div class="toast-header">
                <i class="fas fa-info-circle text-primary me-2"></i>
                <strong class="me-auto">系统提示</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toast-message">
                <!-- 消息内容 -->
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <script>
        // 设置默认日期为今天（MM-DD格式）
        const today = new Date();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        document.getElementById('travelDate').value = `${month}-${day}`;
        
        // 快速搜索表单提交
        document.getElementById('quickSearchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const fromStation = document.getElementById('fromStation').value.trim();
            const toStation = document.getElementById('toStation').value.trim();
            const travelDate = document.getElementById('travelDate').value.trim();
            const sortBy = document.getElementById('sortBy').value;
            
            if (!fromStation || !toStation || !travelDate) {
                showToast('请填写完整的查询信息', 'warning');
                return;
            }
            
            // 验证日期格式
            if (!/^\d{2}-\d{2}$/.test(travelDate)) {
                showToast('日期格式不正确，请使用MM-DD格式，如: 06-15', 'warning');
                return;
            }
            
            // 跳转到搜索页面
            const params = new URLSearchParams({
                from: fromStation,
                to: toStation,
                date: travelDate,
                sort: sortBy
            });
            
            window.location.href = `/search?${params.toString()}`;
        });
        
        // 全局退出登录函数
        function logout() {
            if (confirm('确定要退出登录吗？')) {
                fetch('/api/user/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showToast('退出登录成功', 'success');
                        setTimeout(() => {
                            window.location.href = '/';
                        }, 1000);
                    } else {
                        showToast('退出登录失败', 'error');
                    }
                })
                .catch(error => {
                    showToast('网络错误', 'error');
                });
            }
        }
        
        // 显示Toast通知
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            const toastHeader = toast.querySelector('.toast-header i');
            
            toastMessage.textContent = message;
            
            // 设置图标和颜色
            toastHeader.className = 'me-2 fas ';
            switch (type) {
                case 'success':
                    toastHeader.className += 'fa-check-circle text-success';
                    break;
                case 'error':
                    toastHeader.className += 'fa-exclamation-circle text-danger';
                    break;
                case 'warning':
                    toastHeader.className += 'fa-exclamation-triangle text-warning';
                    break;
                default:
                    toastHeader.className += 'fa-info-circle text-primary';
            }
            
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }
    </script>
</body>
</html>
